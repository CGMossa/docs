<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.5 Optimization for Penalized Maximum Likelihood Estimation | CmdStan User’s Guide</title>
  <meta name="description" content="CmdStan user’s guide." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="1.5 Optimization for Penalized Maximum Likelihood Estimation | CmdStan User’s Guide" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="img/logo-tm.pdf" />
  <meta property="og:description" content="CmdStan user’s guide." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.5 Optimization for Penalized Maximum Likelihood Estimation | CmdStan User’s Guide" />
  
  <meta name="twitter:description" content="CmdStan user’s guide." />
  <meta name="twitter:image" content="img/logo-tm.pdf" />

<meta name="author" content="Stan Development Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="generating-a-sample-from-the-posterior.html"/>
<link rel="next" href="cmdstan-tools.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












<link rel="stylesheet" href="stan-manual.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li style="font-size:110%; font-weight:400; font-family: Verdana, Helvetica, sans; line-height:1.4; margin: 0.5em 0 0 1em"><a href="https://mc-stan.org/docs/cmdstan-guide/index.html" style="color:#4183C4">CmdStan User's Guide</a></li>

<li class="divider"></li>
<li><a href="index.html#introduction"><i style='font-size: 110%; color:#990017;'>Introduction</i></a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Stan Home Page</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#licensing"><i class="fa fa-check"></i>Licensing</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#stan-documentation-users-guide-and-reference-manuals"><i class="fa fa-check"></i>Stan Documentation: User’s Guide and Reference Manuals</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#benefits-of-cmdstan"><i class="fa fa-check"></i>Benefits of CmdStan</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html"><i class="fa fa-check"></i><b>1.1</b> CmdStan Installation</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#gnu-make-utility"><i class="fa fa-check"></i><b>1.1.1</b> GNU-Make Utility</a></li>
<li class="chapter" data-level="1.1.2" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#building-cmdstan"><i class="fa fa-check"></i><b>1.1.2</b> Building CmdStan</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="example-model-and-data.html"><a href="example-model-and-data.html"><i class="fa fa-check"></i><b>1.2</b> Example Model and Data</a></li>
<li class="chapter" data-level="1.3" data-path="compiling-the-program-bernoulli-stan.html"><a href="compiling-the-program-bernoulli-stan.html"><i class="fa fa-check"></i><b>1.3</b> Compiling the Program <code>bernoulli.stan</code></a></li>
<li class="chapter" data-level="1.4" data-path="generating-a-sample-from-the-posterior.html"><a href="generating-a-sample-from-the-posterior.html"><i class="fa fa-check"></i><b>1.4</b> Generating a Sample from the Posterior</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="generating-a-sample-from-the-posterior.html"><a href="generating-a-sample-from-the-posterior.html#running-the-nuts-hmc-sampler"><i class="fa fa-check"></i><b>1.4.1</b> Running the NUTS-HMC Sampler</a></li>
<li class="chapter" data-level="1.4.2" data-path="generating-a-sample-from-the-posterior.html"><a href="generating-a-sample-from-the-posterior.html#stan-csv-output-file"><i class="fa fa-check"></i><b>1.4.2</b> Stan CSV Output File</a></li>
<li class="chapter" data-level="1.4.3" data-path="generating-a-sample-from-the-posterior.html"><a href="generating-a-sample-from-the-posterior.html#summarizing-sampler-outputs-with-stansummary"><i class="fa fa-check"></i><b>1.4.3</b> Summarizing Sampler Output(s) with <code>stansummary</code></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="optimization-for-penalized-maximum-likelihood-estimation.html"><a href="optimization-for-penalized-maximum-likelihood-estimation.html"><i class="fa fa-check"></i><b>1.5</b> Optimization for Penalized Maximum Likelihood Estimation</a></li>
</ul></li>
<li><a href="cmdstan-tools.html#cmdstan-tools"><i style='font-size: 110%; color:#990017;'>CmdStan Tools</i></a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="gnu-make-utility-1.html"><a href="gnu-make-utility-1.html"><i class="fa fa-check"></i><b>2.1</b> GNU-Make utility</a></li>
<li class="chapter" data-level="2.2" data-path="build.html"><a href="build.html"><i class="fa fa-check"></i><b>2.2</b> Building the CmdStan Tools</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CmdStan User’s Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="optimization-for-penalized-maximum-likelihood-estimation" class="section level2">
<h2><span class="header-section-number">1.5</span> Optimization for Penalized Maximum Likelihood Estimation</h2>
<p>The compiled executable model can run Stan’s optimization algorithms
for penalized maximum likelihood estimation which provide a
deterministic method to find the posterior mode.
The executable does not need to be
recompiled in order to switch from sampling to optimization, and the
data input format is the same. The following is a minimal call to
Stan’s optimizer using defaults for everything but the location of the
data file.</p>
<pre><code>&gt; ./bernoulli optimize data file=bernoulli.data.json</code></pre>
<p>Executing this command prints both output to the console and
to a csv file.</p>
<p>The first part of the console output reports on the configuration used.
Here we used all default configurations: the default L-BFGS optimizer,
with default initial stepsize and tolerances for monitoring convergence:</p>
<pre><code> ./bernoulli optimize data file=bernoulli.data.json
method = optimize
  optimize
    algorithm = lbfgs (Default)
      lbfgs
        init_alpha = 0.001 (Default)
        tol_obj = 9.9999999999999998e-13 (Default)
        tol_rel_obj = 10000 (Default)
        tol_grad = 1e-08 (Default)
        tol_rel_grad = 10000000 (Default)
        tol_param = 1e-08 (Default)
        history_size = 5 (Default)
    iter = 2000 (Default)
    save_iterations = 0 (Default)
id = 0 (Default)
data
  file = bernoulli.data.json
init = 2 (Default)
random
  seed = 3316231346 (Default)
output
  file = output.csv (Default)
  diagnostic_file =  (Default)
  refresh = 100 (Default)</code></pre>
<p>The second part of the
output indicates how well the algorithm fared, here converging and
terminating normally. The numbers reported indicate that it took 5
iterations and 8 gradient evaluations.
This is, not surprisingly, far fewer iterations than required
for sampling; even fewer iterations would be used with less stringent
user-specified convergence tolerances.
The <code>alpha</code> value is for step size used.
In the final state the change in parameters was roughly 0.0002
and the length of the gradient roughly 9e-8.</p>
<pre><code>Initial log joint probability = -5.26908
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
       5      -5.00402   0.000172451   9.39034e-08           1           1        8   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance</code></pre>
<p>The output from optimization is written into the file
<code>output.csv</code> by default. The output follows the same pattern as
the output for sampling, first dumping the entire set of parameters
used as comment lines:</p>
<pre><code># stan_version_major = 2
# stan_version_minor = 23
# stan_version_patch = 0
# model = bernoulli_model
# method = optimize
#   optimize
#     algorithm = lbfgs (Default)
...</code></pre>
<p>Following the config information, are two lines of output:
the CSV headers and the recorded values:</p>
<pre><code>lp__,theta
-5.00402,0.2</code></pre>
<p>Note that everything is a comment other than a line for the header,
and a line for the values. Here, the header indicates the unnormalized
log probability with <code>lp\_\_</code> and the model parameter
<code>theta</code>. The maximum log probability is -5.0 and the posterior
mode for <code>theta</code> is 0.20. The mode exactly matches what we would
expect from the data.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>Because the prior was uniform, the result 0.20 represents the maximum
likelihood estimate (MLE) for the very simple Bernoulli model. Note
that no uncertainty is reported.</p>

</div>
<!-- </div> -->
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>The Jacobian adjustment included for the sampler’s log
probability function is not applied during optimization, because it
can change the shape of the posterior and hence the solution.<a href="optimization-for-penalized-maximum-likelihood-estimation.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="generating-a-sample-from-the-posterior.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cmdstan-tools.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true,
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
