<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Stan Functions Reference</title>
  <meta name="description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Stan Functions Reference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Stan Functions Reference" />
  
  <meta name="twitter:description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language." />
  

<meta name="author" content="Stan Development Team">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="functions-algebraic-solver.html">
<link rel="next" href="functions-map.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="../stan-manual.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li style="font-size:110%; font-weight:400; font-family: Verdana, Helvetica, sans; line-height:1.4; margin: 0.5em 0 0 1em">Stan Functions Reference</li>

<li class="divider"></li>
<li><a href="index.html#overview"><i style="font-size: 110%; padding:1.5em 0 0 0; color:#990017;">Overview</i></a></li>
<li><a href="built-in-functions.html#built-in-functions"><i style="font-size: 110%; color:#990017;">Built-In Functions</i></a></li>
<li class="chapter" data-level="1" data-path="void-functions.html"><a href="void-functions.html"><i class="fa fa-check"></i><b>1</b> Void Functions</a></li>
<li class="chapter" data-level="2" data-path="integer-valued-basic-functions.html"><a href="integer-valued-basic-functions.html"><i class="fa fa-check"></i><b>2</b> Integer-Valued Basic Functions</a></li>
<li class="chapter" data-level="3" data-path="real-valued-basic-functions.html"><a href="real-valued-basic-functions.html"><i class="fa fa-check"></i><b>3</b> Real-Valued Basic Functions</a></li>
<li class="chapter" data-level="4" data-path="array-operations.html"><a href="array-operations.html"><i class="fa fa-check"></i><b>4</b> Array Operations</a></li>
<li class="chapter" data-level="5" data-path="matrix-operations.html"><a href="matrix-operations.html"><i class="fa fa-check"></i><b>5</b> Matrix Operations</a></li>
<li class="chapter" data-level="6" data-path="sparse-matrices.html"><a href="sparse-matrices.html"><i class="fa fa-check"></i><b>6</b> Sparse Matrix Operations</a></li>
<li class="chapter" data-level="7" data-path="mixed-operations.html"><a href="mixed-operations.html"><i class="fa fa-check"></i><b>7</b> Mixed Operations</a></li>
<li class="chapter" data-level="8" data-path="compound-arithmetic-and-assignment.html"><a href="compound-arithmetic-and-assignment.html"><i class="fa fa-check"></i><b>8</b> Compound Arithmetic and Assignment</a></li>
<li class="chapter" data-level="9" data-path="higher-order-functions.html"><a href="higher-order-functions.html"><i class="fa fa-check"></i><b>9</b> Higher-Order Functions</a></li>
<li><a href="discrete-distributions.html#discrete-distributions"><i style="font-size: 110%; color:#990017;">Discrete Distributions</i></a></li>
<li class="chapter" data-level="10" data-path="conventions-for-probability-functions.html"><a href="conventions-for-probability-functions.html"><i class="fa fa-check"></i><b>10</b> Conventions for Probability Functions</a></li>
<li class="chapter" data-level="11" data-path="binary-distributions.html"><a href="binary-distributions.html"><i class="fa fa-check"></i><b>11</b> Binary Distributions</a></li>
<li class="chapter" data-level="12" data-path="bounded-discrete-distributions.html"><a href="bounded-discrete-distributions.html"><i class="fa fa-check"></i><b>12</b> Bounded Discrete Distributions</a></li>
<li class="chapter" data-level="13" data-path="unbounded-discrete-distributions.html"><a href="unbounded-discrete-distributions.html"><i class="fa fa-check"></i><b>13</b> Unbounded Discrete Distributions</a></li>
<li class="chapter" data-level="14" data-path="multivariate-discrete-distributions.html"><a href="multivariate-discrete-distributions.html"><i class="fa fa-check"></i><b>14</b> Multivariate Discrete Distributions</a></li>
<li><a href="continuous-distributions.html#continuous-distributions"><i style="font-size: 110%; color:#990017;">Continuous Distributions</i></a></li>
<li class="chapter" data-level="15" data-path="unbounded-continuous-distributions.html"><a href="unbounded-continuous-distributions.html"><i class="fa fa-check"></i><b>15</b> Unbounded Continuous Distributions</a></li>
<li class="chapter" data-level="16" data-path="positive-continuous-distributions.html"><a href="positive-continuous-distributions.html"><i class="fa fa-check"></i><b>16</b> Positive Continuous Distributions</a></li>
<li class="chapter" data-level="17" data-path="non-negative-continuous-distributions.html"><a href="non-negative-continuous-distributions.html"><i class="fa fa-check"></i><b>17</b> Non-negative Continuous Distributions</a></li>
<li class="chapter" data-level="18" data-path="positive-lower-bounded-probabilities.html"><a href="positive-lower-bounded-probabilities.html"><i class="fa fa-check"></i><b>18</b> Positive Lower-Bounded Probabilities</a></li>
<li class="chapter" data-level="19" data-path="continuous-distributions-on-0-1.html"><a href="continuous-distributions-on-0-1.html"><i class="fa fa-check"></i><b>19</b> Continuous Distributions on [0, 1]</a></li>
<li class="chapter" data-level="20" data-path="circular-distributions.html"><a href="circular-distributions.html"><i class="fa fa-check"></i><b>20</b> Circular Distributions</a></li>
<li class="chapter" data-level="21" data-path="bounded-continuous-probabilities.html"><a href="bounded-continuous-probabilities.html"><i class="fa fa-check"></i><b>21</b> Bounded Continuous Probabilities</a></li>
<li class="chapter" data-level="22" data-path="distributions-over-unbounded-vectors.html"><a href="distributions-over-unbounded-vectors.html"><i class="fa fa-check"></i><b>22</b> Distributions over Unbounded Vectors</a></li>
<li class="chapter" data-level="23" data-path="simplex-distributions.html"><a href="simplex-distributions.html"><i class="fa fa-check"></i><b>23</b> Simplex Distributions</a></li>
<li class="chapter" data-level="24" data-path="correlation-matrix-distributions.html"><a href="correlation-matrix-distributions.html"><i class="fa fa-check"></i><b>24</b> Correlation Matrix Distributions</a></li>
<li class="chapter" data-level="25" data-path="covariance-matrix-distributions.html"><a href="covariance-matrix-distributions.html"><i class="fa fa-check"></i><b>25</b> Covariance Matrix Distributions</a></li>
<li><a href="appendix.html#appendix"><i style="font-size: 110%; color:#990017;">Appendix</i></a></li>
<li class="chapter" data-level="26" data-path="math-functions.html"><a href="math-functions.html"><i class="fa fa-check"></i><b>26</b> Mathematical Functions</a></li>
<li><a href="references.html#references"><i style="font-size: 110%; color:#990017;">References</i></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stan Functions Reference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions-ode-solver" class="section level2">
<h2><span class="header-section-number">9.2</span> Ordinary Differential Equation Solvers</h2>
<p>Stan provides built-in ordinary differential equation (ODE) solvers.
Although they look like function applications, the ODE solvers are
special in two ways.</p>
<p>First, the first argument to each of the solvers is a function
specifying the ODE system as an argument, like PKBugs
<span class="citation">(Lunn et al. <a href="#ref-LunnEtAl:1999">1999</a>)</span>. Ordinary Stan functions do not allow functions as
arguments.</p>
<p>Second, some of the arguments to the ODE solvers are restricted to
data only expressions. These expressions must not contain variables
other than those declared in the data or transformed data blocks.
Ordinary Stan functions place no restriction on the origin of
variables in their argument expressions.</p>
<div id="functions-ode-function" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Specifying an Ordinary Differential Equation as a Function</h3>
<p>A system of ODEs is specified as an ordinary function in Stan within
the functions block. The ODE system function must have this function
signature:</p>
<pre><code> real[] ode(real time, real[] state, real[] theta,
            real[] x_r, int[] x_i)</code></pre>
<p>The ODE system function should return the derivative of the state with
respect to time at the time provided. The length of the returned real
array must match the length of the state input into the function.</p>
<p>The arguments to this function are:</p>
<ul>
<li><p><em><code>time</code></em>, the time to evaluate the ODE system</p></li>
<li><p><em><code>state</code></em>, the state of the ODE system at the time specified</p></li>
<li><p><em><code>theta</code></em>, parameter values used to evaluate the ODE system</p></li>
<li><p><em><code>x_r</code></em>, data values used to evaluate the ODE system</p></li>
<li><p><em><code>x_i</code></em>, integer data values used to evaluate the ODE system.</p></li>
</ul>
<p>The ODE system function separates parameter values, <em><code>theta</code></em>, from
data values, <em><code>x_r</code></em>, for efficiency in computing the gradients of the
ODE.</p>
</div>
<div id="non-stiff-solver" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Non-Stiff Solver</h3>
<!-- real[ , ]; integrate_ode_rk45; (function ode, real[] initial_state, real initial_time, real[] times, real[] theta, real[] x_r, int[] x_i); -->
<p></p>
<p><code>real[ , ]</code> <strong><code>integrate_ode_rk45</code></strong><code>(function ode, real[] initial_state, real initial_time, real[] times, real[] theta, real[] x_r, int[] x_i)</code><br>
Solves the ODE system for the times provided using the Runge Kutta
Dopri algorithm with the implementation from Boost.</p>
<!-- real[ , ]; integrate_ode_rk45; (function ode, real[] initial_state, real initial_time, real[] times, real[] theta, real[] x_r, int[] x_i, real rel_tol, real abs_tol, int max_num_steps); -->
<p></p>
<p><code>real[ , ]</code> <strong><code>integrate_ode_rk45</code></strong><code>(function ode, real[] initial_state, real initial_time, real[] times, real[] theta, real[] x_r, int[] x_i, real rel_tol, real abs_tol, int max_num_steps)</code><br>
Solves the ODE system for the times provided using the Runge Kutta
Dopri algorithm with the implementation from Boost with additional
control parameters for the solver.</p>
<!-- real[ , ]; integrate_ode; (function ode, real[] initial_state, real initial_time, real[] times, real[] theta, real[] x_r, int[] x_i); -->
<p></p>
<p><code>real[ , ]</code> <strong><code>integrate_ode</code></strong><code>(function ode, real[] initial_state, real initial_time, real[] times, real[] theta, real[] x_r, int[] x_i)</code><br>
Deprecated. Solves the ODE system for the times provided with a
non-stiff solver. This calls the Runge Kutta Dopri algorithm.</p>
</div>
<div id="stiff-solver" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Stiff Solver</h3>
<!-- real[]; integrate_ode_bdf; (function ode, real[] initial_state, real initial_time, real[] times, real[] theta, data real[] x_r, data int[] x_i); -->
<p></p>
<p><code>real[]</code> <strong><code>integrate_ode_bdf</code></strong><code>(function ode, real[] initial_state, real initial_time, real[] times, real[] theta, data real[] x_r, data int[] x_i)</code><br>
Solves the ODE system for the times provided using the backward
differentiation formula (BDF) method with the implementation from
CVODES.</p>
<!-- real[]; integrate_ode_bdf; (function ode, real[] initial_state, real initial_time, real[] times, real[] theta, data real[] x_r, data int[] x_i, data real rel_tol, data real abs_tol, dta int max_num_steps); -->
<p></p>
<p><code>real[]</code> <strong><code>integrate_ode_bdf</code></strong><code>(function ode, real[] initial_state, real initial_time, real[] times, real[] theta, data real[] x_r, data int[] x_i, data real rel_tol, data real abs_tol, dta int max_num_steps)</code><br>
Solves the ODE system for the times provided using the backward
differentiation formula (BDF) method with the implementation from
CVODES with additional control parameters for the CVODES solver.</p>
</div>
<div id="arguments-to-the-ode-solvers" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Arguments to the ODE solvers</h3>
<p>The arguments to the ODE solvers in both the stiff and non-stiff cases
are as follows.</p>
<ul>
<li><em><code>ode</code></em>: function literal referring to a function specifying the
system of differential equations with signature described in
<a href="functions-ode-solver.html#functions-ode-function">9.2.1</a>:</li>
</ul>
<pre><code> (real, real[], real[], data real[], data int[]):real[]</code></pre>
<p>The arguments represent (1) time, (2) system state, (3) parameters,
(4) real data, and (5) integer data, and the return value contains the
derivatives with respect to time of the state,</p>
<ul>
<li><p><em><code>initial_state</code></em>: initial state, type <code>real[]</code>,</p></li>
<li><p><em><code>initial_time</code></em>: initial time, type <code>int</code> or <code>real</code>,</p></li>
<li><p><em><code>times</code></em>: solution times, type <code>real[]</code>,</p></li>
<li><p><em><code>theta</code></em>: parameters, type <code>real[]</code>,</p></li>
<li><p><code>data</code> <em><code>x_r</code></em>: real data, type <code>real[]</code>, data only, and</p></li>
<li><p><code>data</code> <em><code>x_i</code></em>: integer data, type <code>int[]</code>, data only.</p></li>
</ul>
<p>For more fine-grained control of the ODE solvers, these parameters can
also be provided:</p>
<ul>
<li><p><code>data</code> <em><code>rel_tol</code></em>: relative tolerance for the ODE solver, type
<code>real</code>, data only,</p></li>
<li><p><code>data</code> <em><code>abs_tol</code></em>: absolute tolerance for the ODE solver, type
<code>real</code>, data only, and</p></li>
<li><p><code>data</code> <em><code>max_num_steps</code></em>: maximum number of steps to take in the
ODE solver, type <code>int</code>, data only.</p></li>
</ul>
<div id="return-values" class="section level4">
<h4><span class="header-section-number">9.2.4.1</span> Return values</h4>
<p>The return value for the ODE solvers is an array of type <code>real[,]</code>,
with values consisting of solutions at the specified times.</p>
</div>
<div id="sizes-and-parallel-arrays-1" class="section level4">
<h4><span class="header-section-number">9.2.4.2</span> Sizes and parallel arrays</h4>
<p>The sizes must match, and in particular, the following groups are of
the same size:</p>
<ul>
<li><p>state variables passed into the system function, derivatives
returned by the system function, initial state passed into the
solver, and rows of the return value of the solver,</p></li>
<li><p>solution times and number of rows of the return value of the
solver,</p></li>
<li><p>parameters, real data and integer data passed to the solver will
be passed to the system function</p></li>
</ul>
</div>
</div>
</div>
<h3><i style="font-size: 110%; color:#990017;">References</i></h3>
<div id="refs" class="references">
<div id="ref-LunnEtAl:1999">
<p>Lunn, D. J., J. Wakefield, A. Thomas, N. Best, and D. Spiegelhalter. 1999. <em>PKBugs User Guide</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions-algebraic-solver.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="functions-map.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true,
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
