<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Stan Functions Reference</title>
  <meta name="description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Stan Functions Reference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Stan Functions Reference" />
  
  <meta name="twitter:description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language." />
  

<meta name="author" content="Stan Development Team">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="cumulative-distribution-functions.html">
<link rel="next" href="binary-distributions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="../stan-manual.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li style="font-size:110%; font-weight:400; font-family: Verdana, Helvetica, sans; line-height:1.4; margin: 0.5em 0 0 1em">Stan Functions Reference</li>

<li class="divider"></li>
<li><a href="index.html#overview"><i style="font-size: 110%; padding:1.5em 0 0 0; color:#990017;">Overview</i></a></li>
<li><a href="built-in-functions.html#built-in-functions"><i style="font-size: 110%; color:#990017;">Built-In Functions</i></a></li>
<li class="chapter" data-level="1" data-path="void-functions.html"><a href="void-functions.html"><i class="fa fa-check"></i><b>1</b> Void Functions</a></li>
<li class="chapter" data-level="2" data-path="integer-valued-basic-functions.html"><a href="integer-valued-basic-functions.html"><i class="fa fa-check"></i><b>2</b> Integer-Valued Basic Functions</a></li>
<li class="chapter" data-level="3" data-path="real-valued-basic-functions.html"><a href="real-valued-basic-functions.html"><i class="fa fa-check"></i><b>3</b> Real-Valued Basic Functions</a></li>
<li class="chapter" data-level="4" data-path="array-operations.html"><a href="array-operations.html"><i class="fa fa-check"></i><b>4</b> Array Operations</a></li>
<li class="chapter" data-level="5" data-path="matrix-operations.html"><a href="matrix-operations.html"><i class="fa fa-check"></i><b>5</b> Matrix Operations</a></li>
<li class="chapter" data-level="6" data-path="sparse-matrices.html"><a href="sparse-matrices.html"><i class="fa fa-check"></i><b>6</b> Sparse Matrix Operations</a></li>
<li class="chapter" data-level="7" data-path="mixed-operations.html"><a href="mixed-operations.html"><i class="fa fa-check"></i><b>7</b> Mixed Operations</a></li>
<li class="chapter" data-level="8" data-path="compound-arithmetic-and-assignment.html"><a href="compound-arithmetic-and-assignment.html"><i class="fa fa-check"></i><b>8</b> Compound Arithmetic and Assignment</a></li>
<li class="chapter" data-level="9" data-path="higher-order-functions.html"><a href="higher-order-functions.html"><i class="fa fa-check"></i><b>9</b> Higher-Order Functions</a></li>
<li><a href="discrete-distributions.html#discrete-distributions"><i style="font-size: 110%; color:#990017;">Discrete Distributions</i></a></li>
<li class="chapter" data-level="10" data-path="conventions-for-probability-functions.html"><a href="conventions-for-probability-functions.html"><i class="fa fa-check"></i><b>10</b> Conventions for Probability Functions</a></li>
<li class="chapter" data-level="11" data-path="binary-distributions.html"><a href="binary-distributions.html"><i class="fa fa-check"></i><b>11</b> Binary Distributions</a></li>
<li class="chapter" data-level="12" data-path="bounded-discrete-distributions.html"><a href="bounded-discrete-distributions.html"><i class="fa fa-check"></i><b>12</b> Bounded Discrete Distributions</a></li>
<li class="chapter" data-level="13" data-path="unbounded-discrete-distributions.html"><a href="unbounded-discrete-distributions.html"><i class="fa fa-check"></i><b>13</b> Unbounded Discrete Distributions</a></li>
<li class="chapter" data-level="14" data-path="multivariate-discrete-distributions.html"><a href="multivariate-discrete-distributions.html"><i class="fa fa-check"></i><b>14</b> Multivariate Discrete Distributions</a></li>
<li><a href="continuous-distributions.html#continuous-distributions"><i style="font-size: 110%; color:#990017;">Continuous Distributions</i></a></li>
<li class="chapter" data-level="15" data-path="unbounded-continuous-distributions.html"><a href="unbounded-continuous-distributions.html"><i class="fa fa-check"></i><b>15</b> Unbounded Continuous Distributions</a></li>
<li class="chapter" data-level="16" data-path="positive-continuous-distributions.html"><a href="positive-continuous-distributions.html"><i class="fa fa-check"></i><b>16</b> Positive Continuous Distributions</a></li>
<li class="chapter" data-level="17" data-path="non-negative-continuous-distributions.html"><a href="non-negative-continuous-distributions.html"><i class="fa fa-check"></i><b>17</b> Non-negative Continuous Distributions</a></li>
<li class="chapter" data-level="18" data-path="positive-lower-bounded-probabilities.html"><a href="positive-lower-bounded-probabilities.html"><i class="fa fa-check"></i><b>18</b> Positive Lower-Bounded Probabilities</a></li>
<li class="chapter" data-level="19" data-path="continuous-distributions-on-0-1.html"><a href="continuous-distributions-on-0-1.html"><i class="fa fa-check"></i><b>19</b> Continuous Distributions on [0, 1]</a></li>
<li class="chapter" data-level="20" data-path="circular-distributions.html"><a href="circular-distributions.html"><i class="fa fa-check"></i><b>20</b> Circular Distributions</a></li>
<li class="chapter" data-level="21" data-path="bounded-continuous-probabilities.html"><a href="bounded-continuous-probabilities.html"><i class="fa fa-check"></i><b>21</b> Bounded Continuous Probabilities</a></li>
<li class="chapter" data-level="22" data-path="distributions-over-unbounded-vectors.html"><a href="distributions-over-unbounded-vectors.html"><i class="fa fa-check"></i><b>22</b> Distributions over Unbounded Vectors</a></li>
<li class="chapter" data-level="23" data-path="simplex-distributions.html"><a href="simplex-distributions.html"><i class="fa fa-check"></i><b>23</b> Simplex Distributions</a></li>
<li class="chapter" data-level="24" data-path="correlation-matrix-distributions.html"><a href="correlation-matrix-distributions.html"><i class="fa fa-check"></i><b>24</b> Correlation Matrix Distributions</a></li>
<li class="chapter" data-level="25" data-path="covariance-matrix-distributions.html"><a href="covariance-matrix-distributions.html"><i class="fa fa-check"></i><b>25</b> Covariance Matrix Distributions</a></li>
<li><a href="appendix.html#appendix"><i style="font-size: 110%; color:#990017;">Appendix</i></a></li>
<li class="chapter" data-level="26" data-path="math-functions.html"><a href="math-functions.html"><i class="fa fa-check"></i><b>26</b> Mathematical Functions</a></li>
<li><a href="references.html#references"><i style="font-size: 110%; color:#990017;">References</i></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stan Functions Reference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="vectorization" class="section level2">
<h2><span class="header-section-number">10.8</span> Vectorization</h2>
<p>Stan’s univariate log probability functions, including the log density
functions, log mass functions, log CDFs, and log CCDFs, all support
vectorized function application, with results defined to be the sum of
the elementwise application of the function. Some of the PRNG
functions support vectorization, see section <a href="vectorization.html#prng-vectorization">10.8.3</a>
for more details.</p>
<p>In all cases, matrix operations are at least as fast and usually
faster than loops and vectorized log probability functions are faster
than their equivalent form defined with loops. This isn’t because
loops are slow in Stan, but because more efficient automatic
differentiation can be used. The efficiency comes from the fact that
a vectorized log probably function only introduces one new node into
the expression graph, thus reducing the number of virtual function
calls required to compute gradients in C++, as well as from allowing
caching of repeated computations.</p>
<p>Stan also overloads the multivariate normal distribution, including
the Cholesky-factor form, allowing arrays of row vectors or vectors
for the variate and location parameter. This is a huge savings in
speed because the work required to solve the linear system for the
covariance matrix is only done once.</p>
<p>Stan also overloads some scalar functions, such as <code>log</code> and <code>exp</code>, to
apply to vectors (arrays) and return vectors (arrays). These
vectorizations are defined elementwise and unlike the probability
functions, provide only minimal efficiency speedups over repeated
application and assignment in a loop.</p>
<div id="prob-vectorization" class="section level3">
<h3><span class="header-section-number">10.8.1</span> Vectorized Function Signatures</h3>
<div id="vectorized-scalar-arguments" class="section level4">
<h4><span class="header-section-number">10.8.1.1</span> Vectorized Scalar Arguments</h4>
<p>The normal probability function is specified with the signature</p>
<pre><code> normal_lpdf(reals | reals, reals);</code></pre>
<p>The pseudotype <code>reals</code> is used to indicate that an argument position
may be vectorized. Argument positions declared as <code>reals</code> may be
filled with a real, a one-dimensional array, a vector, or a
row-vector. If there is more than one array or vector argument, their
types can be anything but their size must match. For instance, it is
legal to use <code>normal_lpdf(row_vector | vector, real)</code> as long as the
vector and row vector have the same size.</p>
</div>
<div id="vectorized-vector-and-row-vector-arguments" class="section level4">
<h4><span class="header-section-number">10.8.1.2</span> Vectorized Vector and Row Vector Arguments</h4>
<p>The multivariate normal distribution accepting vector or array of
vector arguments is written as</p>
<pre><code> multi_normal_lpdf(vectors | vectors, matrix);</code></pre>
<p>These arguments may be row vectors, column vectors, or arrays of row
vectors or column vectors.</p>
</div>
<div id="vectorized-integer-arguments" class="section level4">
<h4><span class="header-section-number">10.8.1.3</span> Vectorized Integer Arguments</h4>
<p>The pseudotype <code>ints</code> is used for vectorized integer arguments. Where
it appears either an integer or array of integers may be used.</p>
</div>
</div>
<div id="evaluating-vectorized-log-probability-functions" class="section level3">
<h3><span class="header-section-number">10.8.2</span> Evaluating Vectorized Log Probability Functions</h3>
<p>The result of a vectorized log probability function is equivalent to
the sum of the evaluations on each element. Any non-vector argument,
namely <code>real</code> or <code>int</code>, is repeated. For instance, if <code>y</code> is a vector
of size <code>N</code>, <code>mu</code> is a vector of size <code>N</code>, and <code>sigma</code> is a scalar,
then</p>
<pre><code> ll = normal_lpdf(y | mu, sigma);</code></pre>
<p>is just a more efficient way to write</p>
<pre><code> ll = 0;
 for (n in 1:N)
   ll = ll + normal_lpdf(y[n] | mu[n], sigma);</code></pre>
<p>With the same arguments, the vectorized sampling statement</p>
<pre><code> y ~ normal(mu, sigma);</code></pre>
<p>has the same effect on the total log probability as</p>
<pre><code> for (n in 1:N)
   y[n] ~ normal(mu[n], sigma);</code></pre>
</div>
<div id="prng-vectorization" class="section level3">
<h3><span class="header-section-number">10.8.3</span> Evaluating Vectorized PRNG Functions</h3>
<p>Some PRNG functions accept sequences as well as scalars as arguments.
Such functions are indicated by argument pseudotypes <code>reals</code> or
<code>ints</code>. In cases of sequence arguments, the output will also be a
sequence. For example, the following is allowed in the generated
quantities block.</p>
<pre><code> vector[3] mu = ...;
 real x[3] = normal_rng(mu, 3);</code></pre>
<div id="argument-types" class="section level4">
<h4><span class="header-section-number">10.8.3.1</span> Argument types</h4>
<p>In the case of PRNG functions, arguments marked <code>ints</code> may be integers
or integer arrays, whereas arguments marked <code>reals</code> may be integers or
reals, integer or real arrays, vectors, or row vectors.</p>
<table>
<thead>
<tr class="header">
<th align="left">pseudotype</th>
<th align="left">allowable PRNG arguments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ints</code></td>
<td align="left"><code>int</code>, <code>int[]</code></td>
</tr>
<tr class="even">
<td align="left"><code>reals</code></td>
<td align="left"><code>int</code>, <code>int[]</code>, <code>real</code>, <code>real[]</code>, <code>vector</code>, <code>row_vector</code></td>
</tr>
</tbody>
</table>
</div>
<div id="dimension-matching" class="section level4">
<h4><span class="header-section-number">10.8.3.2</span> Dimension matching</h4>
<p>In general, if there are multiple non-scalar arguments, they must all
have the same dimensions, but need not have the same type. For
example, the <code>normal_rng</code> function may be called with one vector
argument and one real array argument as long as they have the same
number of elements.</p>
<pre><code> vector[3] mu = ...;
 real sigma[3] = ...;
 real x[3] = normal_rng(mu, sigma);</code></pre>
</div>
<div id="return-type" class="section level4">
<h4><span class="header-section-number">10.8.3.3</span> Return type</h4>
<p>The result of a vectorized PRNG function depends on the size of the
arguments and the distribution’s support. If all arguments are
scalars, then the return type is a scalar. For a continuous
distribution, if there are any non-scalar arguments, the return type
is a real array (<code>real[]</code>) matching the size of any of the non-scalar
arguments, as all non-scalar arguments must have matching size.
Discrete distributions return <code>ints</code> and continuous distributions
return <code>reals</code>, each of appropriate size. The symbol <code>R</code> denotes such
a return type.</p>

</div>
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="cumulative-distribution-functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="binary-distributions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true,
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
